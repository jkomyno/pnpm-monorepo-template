name: "  â–¶ï¸  CI Workflow"

on:
  push:
    branches:
      - main
  pull_request:
    paths-ignore:
      - ".vscode/**"
      - "LICENSE"
      - "README.md"
  workflow_dispatch:

concurrency:
  group: pull-${{ github.ref }}-1
  cancel-in-progress: true

env:
  CI: "true"

permissions:
  contents: read
  pull-requests: read

jobs:
  build:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ubuntu-latest]

    name: "Build: ${{ matrix.os }}"

    steps:
      - name: Prepare git
        run: git config --global core.autocrlf false

      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
        with:
          fetch-depth: 0

      - name: "ğŸ’½ï¸ Setup (Node.js)"
        uses: ./.github/actions/setup-node

      - name: "ğŸ—ï¸ Build"
        run: pnpm build

      - name: "ğŸ” Check exports"
        run: pnpm check:exports

      - name: "ğŸš¨ Lint code"
        run: pnpm lint:ci

      - name: "ğŸ§³ Run unit tests"
        run: pnpm test:unit

      - name: "ğŸ“¦ pkg.pr.new (preview release)"
        if: github.event_name == 'pull_request'
        run: pnpm dlx pkg-pr-new publish './packages/*' --packageManager=pnpm
